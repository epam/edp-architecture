@startuml
entity "CR Keycloak Realm" as cr_realm
participant "Keycloak-realm-controller" as keycloak_realm_controller
note right of keycloak_realm_controller
Startup params:
Keycloak server web URL
Keycloak admin login
Keycloak admin password
Central Keycloak realm name "Aka Openshift"
end note
participant "Keycloak Server" as server
entity "CR Keycloak Client" as cr_client

cr_realm -> keycloak_realm_controller: Read\n**Params:**\nnamespace\nname

activate keycloak_realm_controller
keycloak_realm_controller -> keycloak_realm_controller: Realm name = namespace.name
keycloak_realm_controller -> server: Create realm\n**Params:**\nRealm name
keycloak_realm_controller -> server: Update realm with default params
keycloak_realm_controller -> keycloak_realm_controller: Generate EDP Client credentials
keycloak_realm_controller -> cr_client: \
Create client \n\
**Params:** \n\
name: realm name without namespace \n\
is central: true \n\
roles: admin, developer

keycloak_realm_controller -> server: \
Update external identity provider for realm \n\
**Params:** \n\
Central Keycloak realm name \n\
EDP Client credentials

deactivate keycloak_realm_controller

@enduml